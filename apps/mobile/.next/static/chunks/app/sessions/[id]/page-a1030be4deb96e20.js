(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[899],{2528:function(e,s,t){Promise.resolve().then(t.bind(t,8256))},8256:function(e,s,t){"use strict";t.d(s,{SessionDetailClient:function(){return y}});var r=t(1545),n=t(7224),a=t(6573),i=t(6985),o=t(4955),d=t(8653),c=t(1105);let l=(0,c.Z)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),m=(0,c.Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),u=(0,c.Z)("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);var x=t(574),h=t(510);let p=(0,c.Z)("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),b=(0,c.Z)("GitMerge",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]]),f=(0,c.Z)("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);var g=t(4238);function y(e){let{id:s}=e,t=(0,i.useRouter)(),[c,f]=(0,n.useState)("live"),{data:y,isLoading:w}=(0,a.a)({queryKey:["session",s],queryFn:()=>o.h.getSession(s),enabled:!!s}),S=null==y?void 0:y.data;if(w)return(0,r.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,r.jsx)("div",{className:"animate-spin h-8 w-8 border-2 border-primary border-t-transparent rounded-full"})});if(!S)return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-screen p-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Session Not Found"}),(0,r.jsx)("p",{className:"text-muted-foreground text-center mb-4",children:"The session you're looking for doesn't exist or has been deleted."}),(0,r.jsx)("button",{onClick:()=>t.push("/"),className:"bg-primary text-primary-foreground px-4 py-2 rounded-lg",children:"Go Home"})]});let q=[{id:"live",label:"Live",icon:l},{id:"diff",label:"Diff",icon:m},{id:"metrics",label:"Metrics",icon:u},{id:"history",label:"History",icon:x.Z}],T={idle:"text-gray-600",running:"text-blue-600","awaiting-input":"text-yellow-600",error:"text-red-600",done:"text-green-600"}[S.status];return(0,r.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,r.jsxs)("header",{className:"bg-card border-b border-border p-4 safe-area-top",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("button",{onClick:()=>t.back(),className:"flex items-center text-muted-foreground hover:text-foreground touch-target",children:[(0,r.jsx)(h.Z,{className:"h-5 w-5 mr-1"}),"Back"]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:["running"===S.status?(0,r.jsxs)("button",{className:"flex items-center px-3 py-1.5 bg-red-500 text-white rounded-lg touch-target",children:[(0,r.jsx)(p,{className:"h-4 w-4 mr-1"}),"Stop"]}):(0,r.jsxs)("button",{className:"flex items-center px-3 py-1.5 bg-primary text-primary-foreground rounded-lg touch-target",children:[(0,r.jsx)(l,{className:"h-4 w-4 mr-1"}),"Continue"]}),(0,r.jsxs)("button",{className:"flex items-center px-3 py-1.5 border border-border rounded-lg touch-target",children:[(0,r.jsx)(b,{className:"h-4 w-4 mr-1"}),"Merge"]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-lg font-semibold text-foreground truncate",children:S.name}),(0,r.jsxs)("div",{className:"flex items-center mt-1 space-x-3",children:[(0,r.jsx)("span",{className:(0,g.W)("text-sm font-medium",T),children:S.status.charAt(0).toUpperCase()+S.status.slice(1).replace("-"," ")}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:S.repoRoot.split("/").pop()}),S.iterations&&(0,r.jsxs)("span",{className:"text-sm text-muted-foreground",children:[S.iterations.length," iterations"]})]})]}),(0,r.jsx)("div",{className:"flex mt-4 -mb-4 border-b border-border",children:q.map(e=>{let{id:s,label:t,icon:n}=e;return(0,r.jsxs)("button",{onClick:()=>f(s),className:(0,g.W)("flex-1 flex flex-col items-center pb-3 pt-1 touch-target transition-colors",c===s?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground"),children:[(0,r.jsx)(n,{className:"h-4 w-4 mb-1"}),(0,r.jsx)("span",{className:"text-xs font-medium",children:t})]},s)})})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-hidden",children:["live"===c&&(0,r.jsx)(j,{session:S}),"diff"===c&&(0,r.jsx)(N,{sessionId:S.id}),"metrics"===c&&(0,r.jsx)(v,{session:S}),"history"===c&&(0,r.jsx)(k,{session:S})]}),(0,r.jsx)(d.K,{})]})}function j(e){let{session:s}=e;return(0,r.jsxs)("div",{className:"p-4 pb-20",children:[(0,r.jsxs)("div",{className:"bg-card rounded-lg border border-border p-4",children:[(0,r.jsx)("h3",{className:"font-semibold mb-2",children:"Session Prompt"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:s.ampPrompt})]}),"running"===s.status&&(0,r.jsxs)("div",{className:"mt-4 bg-card rounded-lg border border-border p-4",children:[(0,r.jsx)("h3",{className:"font-semibold mb-2",children:"Live Activity"}),(0,r.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,r.jsx)(f,{className:"h-4 w-4 mr-2 animate-pulse"}),"Amp is working on your request..."]})]})]})}function N(e){let{sessionId:s}=e,{data:t,isLoading:n}=(0,a.a)({queryKey:["session-diff",s],queryFn:()=>o.h.getSessionDiff(s)});if(n)return(0,r.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,r.jsx)("div",{className:"animate-spin h-6 w-6 border-2 border-primary border-t-transparent rounded-full"})});let i=null==t?void 0:t.data;return(0,r.jsx)("div",{className:"p-4 pb-20",children:i?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"bg-card rounded-lg border border-border p-4",children:[(0,r.jsx)("h3",{className:"font-semibold mb-2",children:"Summary"}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground space-y-1",children:[(0,r.jsxs)("p",{children:[i.summary.totalFiles," files changed"]}),(0,r.jsxs)("p",{className:"text-green-600",children:["+",i.summary.totalAdditions," additions"]}),(0,r.jsxs)("p",{className:"text-red-600",children:["-",i.summary.totalDeletions," deletions"]})]})]}),i.files.map((e,s)=>(0,r.jsxs)("div",{className:"bg-card rounded-lg border border-border p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("h4",{className:"font-medium text-sm",children:e.path}),(0,r.jsx)("span",{className:(0,g.W)("text-xs px-2 py-1 rounded","added"===e.status&&"bg-green-100 text-green-800","modified"===e.status&&"bg-blue-100 text-blue-800","deleted"===e.status&&"bg-red-100 text-red-800"),children:e.status})]}),(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:[(0,r.jsxs)("span",{className:"text-green-600",children:["+",e.additions]}),(0,r.jsx)("span",{className:"mx-2",children:"•"}),(0,r.jsxs)("span",{className:"text-red-600",children:["-",e.deletions]})]})]},s))]}):(0,r.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,r.jsx)(m,{className:"h-12 w-12 mx-auto mb-2"}),(0,r.jsx)("p",{children:"No changes yet"})]})})}function v(e){var s,t;let{session:n}=e,a=(null===(s=n.iterations)||void 0===s?void 0:s.reduce((e,s)=>(s.metrics&&(e.tokens+=s.metrics.tokenUsage.total,e.cost+=s.metrics.costCents,e.duration+=s.metrics.durationMs),e),{tokens:0,cost:0,duration:0}))||{tokens:0,cost:0,duration:0};return(0,r.jsx)("div",{className:"p-4 pb-20 space-y-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"bg-card rounded-lg border border-border p-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Total Tokens"}),(0,r.jsx)("p",{className:"text-2xl font-bold",children:a.tokens.toLocaleString()})]}),(0,r.jsxs)("div",{className:"bg-card rounded-lg border border-border p-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Total Cost"}),(0,r.jsxs)("p",{className:"text-2xl font-bold",children:["$",(a.cost/100).toFixed(2)]})]}),(0,r.jsxs)("div",{className:"bg-card rounded-lg border border-border p-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Runtime"}),(0,r.jsxs)("p",{className:"text-2xl font-bold",children:[Math.round(a.duration/1e3/60),"m"]})]}),(0,r.jsxs)("div",{className:"bg-card rounded-lg border border-border p-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Iterations"}),(0,r.jsx)("p",{className:"text-2xl font-bold",children:(null===(t=n.iterations)||void 0===t?void 0:t.length)||0})]})]})})}function k(e){let{session:s}=e;return(0,r.jsx)("div",{className:"p-4 pb-20",children:s.iterations&&s.iterations.length>0?(0,r.jsx)("div",{className:"space-y-4",children:s.iterations.map((e,s)=>(0,r.jsxs)("div",{className:"bg-card rounded-lg border border-border p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("h3",{className:"font-medium",children:["Iteration ",s+1]}),(0,r.jsx)("span",{className:(0,g.W)("text-xs px-2 py-1 rounded","completed"===e.status&&"bg-green-100 text-green-800","running"===e.status&&"bg-blue-100 text-blue-800","error"===e.status&&"bg-red-100 text-red-800"),children:e.status})]}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:e.prompt}),(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:[new Date(e.startedAt).toLocaleString(),e.metrics&&(0,r.jsxs)("span",{className:"ml-2",children:["• ",e.metrics.tokenUsage.total," tokens • $",(e.metrics.costCents/100).toFixed(2)]})]})]},e.id))}):(0,r.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,r.jsx)(x.Z,{className:"h-12 w-12 mx-auto mb-2"}),(0,r.jsx)("p",{children:"No iterations yet"})]})})}},8653:function(e,s,t){"use strict";t.d(s,{K:function(){return u}});var r=t(1545),n=t(9339),a=t(6985),i=t(1598),o=t(3784),d=t(3344),c=t(5590),l=t(4238);let m=[{href:"/",icon:i.Z,label:"Sessions"},{href:"/sessions/new",icon:o.Z,label:"New"},{href:"/threads",icon:d.Z,label:"Threads"},{href:"/settings",icon:c.Z,label:"Settings"}];function u(){let e=(0,a.usePathname)();return(0,r.jsx)("nav",{className:"fixed bottom-0 left-0 right-0 z-40 bg-card border-t border-border safe-area-bottom",children:(0,r.jsx)("div",{className:"flex",children:m.map(s=>{let{href:t,icon:a,label:i}=s,o=e===t||"/"!==t&&e.startsWith(t);return(0,r.jsxs)(n.default,{href:t,className:(0,l.W)("flex-1 flex flex-col items-center justify-center py-2 px-1 touch-target mobile-tap","transition-colors duration-200",o?"text-primary":"text-muted-foreground hover:text-foreground"),children:[(0,r.jsx)(a,{className:"h-5 w-5 mb-1"}),(0,r.jsx)("span",{className:"text-xs font-medium",children:i})]},t)})})})}},4955:function(e,s,t){"use strict";t.d(s,{h:function(){return a}});let r=t(660).env.NEXT_PUBLIC_API_URL||"http://localhost:3000";class n{async request(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t="".concat(this.baseUrl).concat(e),r={headers:{"Content-Type":"application/json",...s.headers},...s};try{let e=await fetch(t,r);if(!e.ok){let s=await e.text();throw Error("HTTP ".concat(e.status,": ").concat(s))}return{data:await e.json(),success:!0}}catch(s){return console.error("API request failed: ".concat(e),s),{data:null,success:!1,error:s instanceof Error?s.message:"Unknown error"}}}async health(){return this.request("/health")}async getSessions(){return this.request("/api/v1/sessions")}async getSession(e){return this.request("/api/v1/sessions/".concat(e))}async createSession(e){return this.request("/api/v1/sessions",{method:"POST",body:JSON.stringify(e)})}async iterateSession(e,s){return this.request("/api/v1/sessions/".concat(e,"/iterate"),{method:"POST",body:JSON.stringify(s)})}async abortSession(e){return this.request("/api/v1/sessions/".concat(e,"/abort"),{method:"POST"})}async mergeSession(e){return this.request("/api/v1/sessions/".concat(e,"/merge"),{method:"POST"})}async getSessionDiff(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";return this.request("/api/v1/sessions/".concat(e,"/diff?format=").concat(s))}async getThreads(e){return this.request("/api/v1/threads".concat(e?"?limit=".concat(e):""))}async getThreadMessages(e){return this.request("/api/v1/threads/".concat(e,"/messages"))}async addThreadMessage(e,s){return this.request("/api/v1/threads/".concat(e,"/messages"),{method:"POST",body:JSON.stringify(s)})}async getRepositories(){return this.request("/api/v1/repos")}async scanRepositories(e){return this.request("/api/v1/repos/scan",{method:"POST",body:JSON.stringify({roots:e})})}async cloneRepository(e,s){return this.request("/api/v1/repos/clone",{method:"POST",body:JSON.stringify({url:e,path:s})})}async getConfigs(){return this.request("/api/v1/configs")}constructor(e=r){this.baseUrl=e}}let a=new n},510:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(1105).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},574:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(1105).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])}},function(e){e.O(0,[281,718,573,644,844,744],function(){return e(e.s=2528)}),_N_E=e.O()}]);